<!DOCTYPE html>
<html lang="en">

<header class="main-header">
  <h1 class="brand">Curious Travel</h1>
  <nav class="nav-links">
    <a href="/">Home</a>
    <a href="/logout" class="logout">Logout</a>
    <button id="darkModeToggle">🌙</button>
  </nav>
</header>


<head>
  <meta charset="UTF-8">
  <title>Dashboard</title>
  <link rel="stylesheet" href="/style.css">
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&display=swap" rel="stylesheet">

  <script>
    // Persist dark mode before render
    if (localStorage.getItem('theme') === 'dark') {
      document.documentElement.classList.add('dark');
    }
  </script>
</head>
<body class="dashboard" style="background-image: url('https://www.mapsinternational.co.uk/pub/media/catalog/product/x/s/a/satellite-map-of-the-world_wm00875.jpg'); background-size: cover; background-position: center;">


  <div class="top-bar">
    <h2>Welcome, <%= user.username %>!</h2>
  </div>

  <form id="searchForm">
    <input id="query" placeholder="Search city..." required>
    <button type="submit">Search</button>
  </form>

  <div id="result" class="card fade">
    <p>Search a city to see info here.</p>
  </div>

  <h3>Your Search History:</h3>
<ul id="historyList">
  <% user.history.slice(-5).reverse().forEach(h => { %>
    <li><a href="#" class="history-link"><%= h %></a></li>
  <% }) %>
</ul>

  <script>
    const form = document.getElementById('searchForm');
    const result = document.getElementById('result');
    const historyList = document.getElementById('historyList');
    const toggle = document.getElementById('darkModeToggle');

    form.addEventListener('submit', async e => {
      e.preventDefault();
      result.innerHTML = '<p>Loading...</p>';
      result.classList.remove('visible');

      const q = document.getElementById('query').value;

      try {
        const res = await fetch(`/api/search?q=${encodeURIComponent(q)}`);
        const data = await res.json();

        const { weather, wiki, movies, tracks, images, history } = data;

result.innerHTML = `
  <div class="image-carousel">
  ${images.map(src => `<img class="carousel-img" src="${src}" alt="City image">`).join('')}
</div>


  <div class="card">
    <h3>🌤️ Weather in ${weather.name}, ${weather.sys.country}</h3>
    <p><strong>${weather.weather[0].main}</strong>: ${weather.weather[0].description}</p>
    <p>Temp: ${weather.main.temp}°C (Feels like: ${weather.main.feels_like}°C)</p>
    <p>Humidity: ${weather.main.humidity}% | Pressure: ${weather.main.pressure} hPa</p>
    <p>Wind: ${weather.wind.speed} m/s</p>
  </div>

  <div class="card">
    <h3>📘 Wiki: ${wiki.title}</h3>
    <p>${wiki.extract}</p>
    <p><a href="${wiki.content_urls.desktop.page}" target="_blank">Read more</a></p>
  </div>

  ${movies.length ? `<div class="card"><h3>🎬 Top Movies</h3><ul>${movies.map(m => `<li>${m.title} (${m.release_date?.substring(0, 4) || ''})</li>`).join('')}</ul></div>` : ''}

  ${tracks.length ? `<div class="card"><h3>🎵 Popular Tracks</h3><ul>${tracks.map(t => `<li><a href="${t.url}" target="_blank">${t.name}</a> – ${t.artists}</li>`).join('')}</ul></div>` : ''}
`;


        setTimeout(() => result.classList.add('visible'), 100);

        historyList.innerHTML = '';
        history.forEach(h => {
          const li = document.createElement('li');
          li.textContent = h;
          historyList.appendChild(li);
        });

      } catch (err) {
        result.innerHTML = `<p style="color:red;">⚠️ Error: ${err.message}</p>`;
      }
    });

    toggle.addEventListener('click', () => {
      const html = document.documentElement;
      const isDark = html.classList.toggle('dark');
      localStorage.setItem('theme', isDark ? 'dark' : 'light');
      toggle.textContent = isDark ? '☀️' : '🌙';
    });

    document.addEventListener('click', async e => {
  if (e.target.classList.contains('history-link')) {
    e.preventDefault();
    const q = e.target.textContent;
    document.getElementById('query').value = q;
    form.dispatchEvent(new Event('submit'));
  }
});

  </script>
</body>

<footer class="main-footer">
  <p>&copy; 2025 Curious Travel. All rights reserved.</p>
</footer>

</html>
